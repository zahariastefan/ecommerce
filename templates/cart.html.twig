{% extends 'base.html.twig' %}

{% block body %}

    {%  set arrayItems = [] %}
    {% for nameOfProduct, nrOfPresence in productsInCart %}
        {% if nameOfProduct == 0 %}
        {% set nameOfProduct = 1 %}
        {% endif %}

        {%  set arrayItems = arrayItems|merge(
            [
                {
                    nrPresence : nrOfPresence,
                    title : nameOfProduct
                }
            ]
        ) %}
    {% endfor %}
    <div class="container container_cart justify-content-center">
        <form action="{{ path('app_thanks') }}" class="d-grid form_checkout ">
            <div class="row">
                <div class="col-sm first_column_cart">
                    {% for key, oneItemArr in arrayItems %}
                        <div class="oneItemDiv{{ key }}">
                            <p class="oneItemTitle">{{ oneItemArr.title }} </p>
                            <p class="nr_total_presence">{{ oneItemArr.nrPresence }}</p> <br>
                            <i class="fa-solid fa-plus add_to_cart_button m-3"></i>
                            <i class="fas fa-minus remove_to_cart_button m-3"></i>
                            <input type="hidden" name="item{{ key }}" value='{"item":"{{ oneItemArr.title }}","quantity":{{ oneItemArr.nrPresence }}}'>
                        </div>
                    {% endfor %}

                </div>
                <div class="col-sm second_column_cart">
                    <p>Payment Details</p>
                    <label for="user_data"> Use My Own Data
                        <input type="checkbox" name="user_data" id="user_data">
                    </label><br>

                    <input type="text" name="name" placeholder="Name" id="name" required>
                    <input type="text" name="surname" placeholder="Surname" id="surname" required>
                    <input type="text" name="city" placeholder="City" id="city" required>
                    <input type="text" name="street" placeholder="Street" id="street" required>
                    <input type="text" name="number" placeholder="Number" id="number" required>
                    <input type="text" name="building" placeholder="Building" id="building" required>
                    <input type="text" name="phone" placeholder="phone" id="phone" required>
                    <input type="text" name="email" placeholder="Email" id="email"><br><br>
                    <p>Choose payment type</p>
                    <div class="d-inline-flex">
                        <input type="checkbox" name="ramburs" required>
                        <label for="ramburs">Offline Pay</label>
                    </div>
                    <br>
                    <button type="submit">Send Order</button>
                </div>
            </div>
        </form>
    </div>


    <script>
        {#$('.add_to_cart_button').click((e)=>{#}
        {#    var items_number = $('.items_number').text();#}
        {#    $('.items_number').text(parseInt(items_number) + 1);#}
        {#    var classNameOfParent = $(e.target).parent().attr('class');#}
        {#    var oneItemName = $('.'+classNameOfParent + '  p.oneItemTitle').text();#}
        {#    var nrOfPresence = $('.'+classNameOfParent + '  p.nr_total_presence').text();#}
        {#    $('.'+classNameOfParent + ' > p.nr_total_presence').text(parseInt(nrOfPresence) + 1);#}

        {#    $('.'+classNameOfParent+' > input[type="text"]').val('{"item":"'+oneItemName+'","quantity":'+ (parseInt(nrOfPresence) + 1) +'}');#}
        {#    // alert(classNameOfParent);#}

        {#    var path = '{{ path('app_add_cart') }}';#}
        {#    var fullUrl   = window.location.origin + path;#}
        {#    $.ajax({#}
        {#        type: "POST",#}
        {#        url: fullUrl,#}
        {#        data: {#}
        {#            itemId :oneItemName,#}
        {#            cartPage : 1,#}
        {#        },#}
        {#        complete: function (data) {#}

        {#        }#}
        {#    });#}
        {#});#}
        {#$('.remove_to_cart_button').click((e)=>{#}
        {#    var items_number = $('.items_number').text();#}
        {#    $('.items_number').text(parseInt(items_number) - 1);#}
        {#    var classNameOfParent2 = $(e.target).parent().attr('class');#}

        {#    var oneItemName = $('.'+classNameOfParent2 + '  p.oneItemTitle').text();#}
        {#    var nrOfPresence = $('.'+classNameOfParent2 + '  p.nr_total_presence').text();#}
        {#    $('.'+classNameOfParent2 + ' p.nr_total_presence').text(parseInt(nrOfPresence) - 1);#}

        {#    $('.'+classNameOfParent2+' > input[type="text"]').val('{"item":"'+oneItemName+'","quantity":'+ (parseInt(nrOfPresence) - 1) +'}');#}


        {#    if(parseInt(nrOfPresence) === 1){#}
        {#        $(e.target).parent().remove();#}
        {#    }#}


        {#    var path = '{{ path('app_remove_cart') }}';#}
        {#    var fullUrl   = window.location.origin + path;#}
        {#    $.ajax({#}
        {#        type: "POST",#}
        {#        url: fullUrl,#}
        {#        data: {#}
        {#            itemId :oneItemName,#}
        {#            cartPage : 1,#}
        {#        },#}
        {#        complete: function (data) {#}

        {#        }#}
        {#    });#}
        {#});#}

        var path = '{{ path('app_add_cart') }}';
        var fullUrl   = window.location.origin + path;
        addToCart(fullUrl);
        var path2 = '{{ path('app_remove_cart') }}';
        var fullUrl2   = window.location.origin + path2;
        removeToCart(fullUrl2);
        function addToCart(fullUrl){
            $('.add_to_cart_button').click((e)=>{
                var items_number = $('.items_number').text();
                $('.items_number').text(parseInt(items_number) + 1);
                var classNameOfParent = $(e.target).parent().attr('class');
                var oneItemName = $('.'+classNameOfParent + '  p.oneItemTitle').text();
                var nrOfPresence = $('.'+classNameOfParent + '  p.nr_total_presence').text();

                // alert(classNameOfParent);


                $.ajax({
                    type: "POST",
                    url: fullUrl,
                    data: {
                        itemId :oneItemName,
                        cartPage : 1,
                    },
                    complete: function (data) {
                        $('.'+classNameOfParent + ' > p.nr_total_presence').text(parseInt(nrOfPresence) + 1);
                        $('.'+classNameOfParent+' > input[type="text"]').val('{"item":"'+oneItemName+'","quantity":'+ (parseInt(nrOfPresence) + 1) +'}');

                    }
                });
            });
        }

        function removeToCart(fullUrl){
            $('.remove_to_cart_button').click((e)=>{
                var items_number = $('.items_number').text();
                $('.items_number').text(parseInt(items_number) - 1);
                var classNameOfParent2 = $(e.target).parent().attr('class');

                var oneItemName = $('.'+classNameOfParent2 + '  p.oneItemTitle').text();
                var nrOfPresence = $('.'+classNameOfParent2 + '  p.nr_total_presence').text();



                if(parseInt(nrOfPresence) === 1){
                    $(e.target).parent().remove();
                }

                $.ajax({
                    type: "POST",
                    url: fullUrl,
                    data: {
                        itemId :oneItemName,
                        cartPage : 1,
                    },
                    complete: function (data) {
                        $('.'+classNameOfParent2 + ' p.nr_total_presence').text(parseInt(nrOfPresence) - 1);

                        $('.'+classNameOfParent2+' > input[type="text"]').val('{"item":"'+oneItemName+'","quantity":'+ (parseInt(nrOfPresence) - 1) +'}');
                    }
                });
            });
        }

        {% if app.user %}
        $('#user_data').click(()=>{
            if($('#user_data').is(':checked')){
                $('#name').attr('value', '{{ app.user.name }}');
                $('#surname').attr('value', '{{ app.user.surname }}');
                $('#city').attr('value', '{{ app.user.city }}');
                $('#street').attr('value', '{{ app.user.street }}');
                $('#number').attr('value', '{{ app.user.streetNumber }}');
                $('#building').attr('value', '{{ app.user.building }}');
                $('#phone').attr('value', '{{ app.user.phone }}');
                $('#email').attr('value', '{{ app.user.email }}');
            }
            if(!$('#user_data').is(':checked')){
                $('#name').removeAttr('value');
                $('#surname').removeAttr('value');
                $('#city').removeAttr('value');
                $('#street').removeAttr('value');
                $('#number').removeAttr('value');
                $('#building').removeAttr('value');
                $('#phone').removeAttr('value');
                $('#email').removeAttr('value');

            }

        });
        {% endif %}
    </script>
{% endblock %}